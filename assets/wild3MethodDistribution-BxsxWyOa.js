import{R as m,j as e,S as R,H as k,b,I as A,o as w,A as W,y as u,B as D,u as $,a as x,n as E,r as v,p as O,d as L,f as C,t as j,i as g,J as N,z as V,l as U,_ as F,w as z,v as G}from"./index-DOlHlz85.js";import{e as I,g as J,a as K,f as B,d as H,h as Y,j as q}from"./utils--sK6bxK_.js";const Q=[{title:"Moment",dataIndex:"moment"},{title:e.jsxs(e.Fragment,{children:["Cycle from",e.jsx("br",{}),"Sweet Scent start"]}),dataIndex:"cycle",key:"cycle",render:(n,a)=>{if(a.diff_cycle_with_compare===null)return`${n}`;const t=a.diff_cycle_with_compare>0?"+":"";return`${n} (${t}${a.diff_cycle_with_compare})`}},{title:"Increment",dataIndex:"increment",render:(n,a)=>{if(a.diff_increment_with_compare===null)return`${n}`;const t=a.diff_increment_with_compare>0?"+":"";return`${n} (${t}${a.diff_increment_with_compare})`}}],X=w({advanceAtSweetScentWildEncounter:u().optional(),cycleAtSweetScentWildEncounter:u().optional(),cycleAtMoments:W(w({moment:D(),cycle:u()}))}),Z=n=>{try{const a=JSON.parse(n);return X.parse(a)}catch{return null}},ee=({cycleAtMoments:n})=>{const[a,t]=m.useState(""),[l,s]=m.useState(!1),i=m.useMemo(()=>{const r=Z(a);return n.map((c,p)=>{var h;const d=p===0?void 0:n[p-1],y=r==null?void 0:r.cycleAtMoments.find(f=>f.moment===c.moment),S=p===0?0:(h=r==null?void 0:r.cycleAtMoments.find(f=>f.moment===(d==null?void 0:d.moment)))==null?void 0:h.cycle,_=c.cycle-((d==null?void 0:d.cycle)??0);if(y!=null&&S!=null){const f=y.cycle-S,P=_-f;return{...c,uid:Math.random(),diff_cycle_with_compare:c.cycle-y.cycle,increment:_,diff_increment_with_compare:P}}return{...c,uid:Math.random(),increment:_,diff_cycle_with_compare:null,diff_increment_with_compare:null}})},[n,a]),o=m.useMemo(()=>[{label:"Display debugging options?",input:e.jsx(R,{onChange:r=>{s(r)}})},...l?[{label:e.jsxs(e.Fragment,{children:["Copy-paste the JSON generated by this"," ",e.jsx("a",{href:"https://raw.githubusercontent.com/RainingChain/pk_emu_scripts/refs/heads/main/Gen3/wild3_cycle_at_moments.lua",children:"lua script"})," ","after a wild encounter to compare with the tool results."]}),key:"compareCycleAtMomentsStr",direction:"column",input:e.jsx(k,{rows:5,onChange:r=>{t(r.target.value)}})}]:[]],[l]);return e.jsxs(e.Fragment,{children:[e.jsx(b,{fields:o}),l&&e.jsxs("div",{children:[e.jsx("strong",{children:"Use case:"})," Detect when the tool miscalculates cycles and simplify its calibration by developpers."]}),l&&e.jsx(A,{columns:Q,rowKey:"uid",dataSource:i})]})},M=["Fastest","Average","Slowest","From PID","Custom"],te=w({map:D(),encounterType:F(Y),advance:u().int().min(0),tid:u().int().min(0).max(65535),sid:u().int().min(0).max(65535),leadTypeIdx:u(),leadSpeedType:F(M),leadPID:u().min(0).max(4294967295),leadCycleSpeed:u().min(18).max(900)}),ne=()=>({map:"MAP_ROUTE101",encounterType:"Land",tid:0,sid:0,advance:0,leadTypeIdx:0,leadSpeedType:"Average",leadPID:0,leadCycleSpeed:0}),T=[{label:"Ordinary lead",value:"Vanilla"},{label:"Egg",value:"Egg"},...E.map(n=>({label:`Synchronize (${n})`,value:{Synchronize:n}})),{label:"Cute Charm (Male)",value:{CuteCharm:"Male"}},{label:"Cute Charm (Female)",value:{CuteCharm:"Female"}}],ae=(n,a,t,l)=>{const s=I.encounter_tables.filter(o=>o.map_id===n).map(o=>o.encounter_type),i=[{label:"Map",input:e.jsx(C,{name:"map",options:j(I.maps,K)})},{label:"Encounter Type",input:e.jsx(C,{name:"encounterType",options:j(s,B)})},{label:"TID",input:e.jsx(g,{name:"tid",numType:"decimal"})},{label:"SID",input:e.jsx(g,{name:"sid",numType:"decimal"})},{label:"Lead",input:e.jsx(C,{name:"leadTypeIdx",options:T.map((o,r)=>({label:o.label,value:r}))})}];return a!=="Egg"&&(i.push({label:"Lead Speed",input:e.jsx(N,{name:"leadSpeedType",options:M.slice(0)})}),t==="From PID"?i.push({label:"",key:"From PID",input:e.jsx(b,{fields:[{label:"Lead PID:",input:e.jsx(g,{name:"leadPID",numType:"hex"})}]})}):t==="Custom"&&i.push({label:"",key:"Custom",input:e.jsx(b,{fields:[{label:"PID modulo cycle count:",input:e.jsx(g,{name:"leadCycleSpeed",numType:"decimal"})}]})}),i.push({label:"",input:e.jsx(b,{fields:[{label:"Cycle Count:",input:`${l} cycles`}]})})),i.push({label:"Advance",input:e.jsx(g,{name:"advance",numType:"decimal"})}),i},se=()=>{const{setFieldValue:n}=$(),a=x({name:"map"}),t=x({name:"leadTypeIdx"}),l=x({name:"leadSpeedType"}),s=x({name:"leadCycleSpeed"}),i=x({name:"leadPID"}),o=m.useMemo(()=>ae(a,T[t].value,l,s),[a,t,l,s]);return m.useEffect(()=>{re(l,s,i).then(r=>{n("leadCycleSpeed",r)})},[n,s,l,i]),e.jsx(b,{fields:o})},le=n=>[{title:e.jsxs(e.Fragment,{children:["Cycle at start",e.jsx("br",{})," of Sweet Scent"]}),key:"Cycle at start",dataIndex:"pre_sweet_scent_cycle_ranges",render:t=>t.length===0?"Less than 0":t.map(s=>`${s.start} - ${s.start+s.len-1}`).map(s=>e.jsx("div",{children:s},s))},{title:"Likelihood",dataIndex:"method_probability",render:t=>G(t)},{title:"Method",dataIndex:"method"},{title:"Species",dataIndex:"species"},{title:"PID",dataIndex:"pid",monospace:!0,render:t=>t.toString(16).padStart(8,"0").toUpperCase()},{title:"Shiny",dataIndex:"shiny",render:t=>t?"Yes":"No"},...z],re=async(n,a,t)=>V(n).with("Fastest",()=>18).with("Slowest",()=>900).with("Average",()=>775).with("Custom",()=>a).with("From PID",()=>v.calculate_pid_speed(t)).exhaustive();let ie=0;const ce=(n,a)=>{const t=q.indexOf(n.searcher_res.encounter_slot),l=t==-1?"None":a.slots[t].species;return{...n.searcher_res,...n.searcher_res.ivs,method_probability:n.method_probability,pre_sweet_scent_cycle_ranges:n.pre_sweet_scent_cycle_ranges,species:l,uid:ie++}},oe=(n,a)=>n.map(t=>ce(t,a)).sort((t,l)=>{var i,o,r,c;const s=(((i=t.pre_sweet_scent_cycle_ranges[0])==null?void 0:i.start)??-1)-(((o=l.pre_sweet_scent_cycle_ranges[0])==null?void 0:o.start)??-1);return s!==0?s:(((r=t.pre_sweet_scent_cycle_ranges[0])==null?void 0:r.len)??0)-(((c=l.pre_sweet_scent_cycle_ranges[0])==null?void 0:c.len)??0)}),ue=({game:n})=>{const[a,t]=m.useState([]),[l,s]=m.useState([]),i=n==="emerald"?0:1440,o=m.useCallback(async c=>{const p={advance:c.advance,tid:c.tid,sid:c.sid,map_idx:0,encounter_slot:null,methods:["Wild1","Wild2","Wild3","Wild4","Wild5"],lead:T[c.leadTypeIdx].value,filter:O(U()),gen3_filter:J(H()),consider_cycles:!0,consider_rng_manipulated_lead_pid:!0,generate_even_if_impossible:!0},d=I.encounter_tables.find(h=>h.map_id===c.map&&h.encounter_type===c.encounterType);if(d==null)return t([]);const{results:y,cycle_at_moments:S}=await v.generate_gen3_wild_distribution(i,p,d,c.leadCycleSpeed),_=oe(y,d);t(_),s(S)},[i]),r=m.useMemo(()=>ne(),[]);return e.jsxs(e.Fragment,{children:[e.jsx(L,{getColumns:le,results:a,validationSchema:te,initialValues:r,onSubmit:o,submitTrackerId:"wild3_find_target",rowKey:"uid",children:e.jsx(se,{})}),e.jsx(ee,{cycleAtMoments:l})]})};export{ue as Wild3MethodDistribution,se as Wild3MethodDistributionFields};
