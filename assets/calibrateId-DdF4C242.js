import{aY as b,R as o,j as n,a as T,r as D,q as g,z as c,aZ as C,I as O}from"./index-DXZ5ShUP.js";import{R}from"./rngToolForm-B4hBWdo1.js";import{f as u,C as S}from"./offsetSymbol-BhtzUnCn.js";import{a as j}from"./id-Bad5r4ra.js";import"./useGen3Timer-D-oFIk24.js";const k=e=>[{title:e.Calibrate,dataIndex:"seed",render:(d,l)=>n.jsx(S,{type:"gen4",trackerId:"calibrate_gen4_id",hitDelay:l.seed_time.delay,timer:C,previousStepOnClick:!0})},{title:e["Flip Delay"],dataIndex:"flipDelay",render:d=>d?n.jsx(O,{name:"CheckCircle",color:"Success",size:30}):null},{title:e["Delay Offset"],dataIndex:"delayOffset",render:u},{title:e["Second Offset"],dataIndex:"secondOffset",render:u},{title:e.TID,dataIndex:"tid"},{title:e.Delay,dataIndex:"delay"},{title:e.Seconds,dataIndex:"seconds"}],F=c.object({tid:c.number().int().min(0).max(65535)}),h={tid:0},q=()=>{const[{target:e}]=b(),[d,l]=o.useState([]),r=e==null?void 0:e.tid,f=o.useCallback(s=>{const i=s["Target TID"],a=s.None;return[{label:`${i}: ${r??a}`,input:null},{label:s["Obtained TID"],input:n.jsx(T,{name:"tid",numType:"decimal"})}]},[r]),y=o.useCallback(async s=>{if(e==null)return;const{datetime:i,delay:a}=e.seed_time,p=a-1e3,x=a+1e3,I=await D.generate_dppt_ids({datetime:i,min_delay:p,max_delay:x,filter:j({type:"tid",value0:s.tid,value1:null})}),_=g(I,t=>Math.abs(t.seed_time.delay-a)).map(t=>{const m=t.seed_time.datetime.second-i.second;return{...t,seed:t.seed_time.seed,flipDelay:m%2===0&&a%2!==t.seed_time.delay%2,delayOffset:t.seed_time.delay-a,delay:t.seed_time.delay,seconds:t.seed_time.datetime.second,secondOffset:m}});l(_)},[e]);return n.jsx(R,{getFields:f,getColumns:k,results:d,initialValues:h,validationSchema:F,onSubmit:y,submitTrackerId:"generate_dppt_id"})};export{q as CalibrateId4};
