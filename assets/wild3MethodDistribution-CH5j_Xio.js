import{R as p,j as e,K as O,L as W,f as w,M as N,o as k,D as $,C as f,E as D,u as v,e as _,r as T,p as E,i as L,l as b,t as S,n as g,O as V,z as U,v as G,_ as x,A as K,y as J}from"./index-CFYbhQRX.js";import{g as F,c as q,a as z,f as B,d as Y,l as H,j as Q,e as X,h as Z,u as C,k as ee,w as te,n as ae,m as se,o as ne}from"./wild3GameData-CjVCVzna.js";const ie=[{title:"Moment",dataIndex:"moment"},{title:e.jsxs(e.Fragment,{children:["Cycle from",e.jsx("br",{}),"Sweet Scent start"]}),dataIndex:"cycle",key:"cycle",render:(t,a)=>{if(a.diff_cycle_with_compare===null)return`${t}`;const s=a.diff_cycle_with_compare>0?"+":"";return`${t} (${s}${a.diff_cycle_with_compare})`}},{title:"Increment",dataIndex:"increment",render:(t,a)=>{if(a.diff_increment_with_compare===null)return`${t}`;const s=a.diff_increment_with_compare>0?"+":"";return`${t} (${s}${a.diff_increment_with_compare})`}}],re=k({advanceAtSweetScentWildEncounter:f().optional(),cycleAtSweetScentWildEncounter:f().optional(),cycleAtMoments:$(k({moment:D(),cycle:f()}))}),le=t=>{try{const a=JSON.parse(t);return re.parse(a)}catch{return null}},oe=({cycleAtMoments:t})=>{const[a,s]=p.useState(""),[i,r]=p.useState(!1),n=p.useMemo(()=>{const o=le(a);return t.map((l,c)=>{var j;const u=c===0?void 0:t[c-1],m=o==null?void 0:o.cycleAtMoments.find(y=>y.moment===l.moment),I=c===0?0:(j=o==null?void 0:o.cycleAtMoments.find(y=>y.moment===(u==null?void 0:u.moment)))==null?void 0:j.cycle,h=l.cycle-((u==null?void 0:u.cycle)??0);if(m!=null&&I!=null){const y=m.cycle-I,A=h-y;return{...l,uid:Math.random(),diff_cycle_with_compare:l.cycle-m.cycle,increment:h,diff_increment_with_compare:A}}return{...l,uid:Math.random(),increment:h,diff_cycle_with_compare:null,diff_increment_with_compare:null}})},[t,a]),d=p.useMemo(()=>[{label:"Display debugging options?",input:e.jsx(O,{onChange:o=>{r(o)}})},...i?[{label:e.jsxs(e.Fragment,{children:["Copy-paste the JSON generated by this"," ",e.jsx("a",{href:"https://raw.githubusercontent.com/RainingChain/pk_emu_scripts/refs/heads/main/Gen3/wild3_cycle_at_moments.lua",children:"lua script"})," ","after a wild encounter to compare with the tool results."]}),key:"compareCycleAtMomentsStr",direction:"column",input:e.jsx(W,{rows:5,onChange:o=>{s(o.target.value)}})}]:[]],[i]);return e.jsxs(e.Fragment,{children:[e.jsx(w,{fields:d}),i&&e.jsxs("div",{children:[e.jsx("strong",{children:"Use case:"})," Detect when the tool miscalculates cycles and simplify its calibration by developpers."]}),i&&e.jsx(N,{columns:ie,rowKey:"uid",dataSource:n})]})},M=q(),P=["Fastest","Average","Slowest","From PID","Custom"],ce=k({map:D(),action:x(ne),advance:f().int().min(0),tid:f().int().min(0).max(65535),sid:f().int().min(0).max(65535),leadIdx:f().min(0).max(F.length-1),leadSpeedType:x(P),leadPID:f().min(0).max(4294967295),leadCycleSpeed:f().min(18).max(900),feebasState:x(se),roamerState:x(ae),massOutbreakState:x(te)}),me=()=>({map:"MAP_ROUTE101",action:"SweetScentLand",tid:0,sid:0,advance:0,leadIdx:0,leadSpeedType:"Average",leadPID:0,leadCycleSpeed:0,feebasState:"NotInMap",roamerState:"Inactive",massOutbreakState:"Inactive"}),R=(t,a)=>{const s=Array.from(M.mapSetupsBySpecies.values()).flat().filter(n=>n.map_data.map_id===t),i=s.filter(n=>n.actions.includes(a)),r=C(i.flatMap(n=>n.feebas_states)).filter(n=>t!=="MAP_ROUTE119"||n!=="NotInMap");return{actions:C(s.flatMap(n=>n.actions)),feebas_states:r,roamer_states:C(i.flatMap(n=>n.roamer_states)),mass_outbreak_states:C(i.flatMap(n=>n.mass_outbreak_states))}},de=(t,a,s,i,r)=>{const{actions:n,feebas_states:d,roamer_states:o,mass_outbreak_states:l}=R(t,a),c=[{label:"Map",input:e.jsx(b,{name:"map",options:S(M.maps,B)})}];return n.length===0||(c.push({label:"Player action",input:e.jsx(b,{name:"action",options:S(n,Y)})},{label:"TID",input:e.jsx(g,{name:"tid",numType:"decimal"})},{label:"SID",input:e.jsx(g,{name:"sid",numType:"decimal"})},{label:"Lead",input:e.jsx(b,{name:"leadIdx",options:H})}),s!=="Egg"&&(c.push({label:"Lead Speed",input:e.jsx(V,{name:"leadSpeedType",options:P.slice(0)})}),i==="From PID"?c.push({label:"",key:"From PID",input:e.jsx(w,{fields:[{label:"Lead PID:",input:e.jsx(g,{name:"leadPID",numType:"hex"})}]})}):i==="Custom"&&c.push({label:"",key:"Custom",input:e.jsx(w,{fields:[{label:"PID modulo cycle count:",input:e.jsx(g,{name:"leadCycleSpeed",numType:"decimal"})}]})}),c.push({label:"",input:e.jsx(w,{fields:[{label:"Cycle Count:",input:`${r} cycles`}]})})),c.push({label:"Advance",input:e.jsx(g,{name:"advance",numType:"decimal"})}),d.length>1&&c.push({label:"Feebas state",input:e.jsx(b,{name:"feebasState",options:S(d,Q)})}),o.length>1&&c.push({label:"Roamer state",input:e.jsx(b,{name:"roamerState",options:S(o,X)})}),l.length>1&&c.push({label:"Mass outbreak state",input:e.jsx(b,{name:"massOutbreakState",options:S(l,Z)})})),c},ue=()=>{const{setFieldValue:t}=v(),a=_({name:"map"}),s=_({name:"leadIdx"}),i=_({name:"leadSpeedType"}),r=_({name:"leadCycleSpeed"}),n=_({name:"leadPID"}),d=_({name:"action"}),o=_({name:"feebasState"}),l=_({name:"massOutbreakState"}),c=_({name:"roamerState"}),u=p.useMemo(()=>de(a,d,F[s],i,r),[a,d,s,i,r]);return p.useEffect(()=>{const m=R(a,d);m.actions.length>0&&m.actions.includes(d)===!1&&t("action",m.actions[0]),m.feebas_states.length>0&&m.feebas_states.includes(o)===!1&&t("feebasState",m.feebas_states[0]),m.mass_outbreak_states.length>0&&m.mass_outbreak_states.includes(l)===!1&&t("massOutbreakState",m.mass_outbreak_states[0]),m.roamer_states.length>0&&m.roamer_states.includes(c)===!1&&t("roamerState",m.roamer_states[0])},[a,d,o,l,c,t]),p.useEffect(()=>{_e(i,r,n).then(m=>{t("leadCycleSpeed",m)})},[t,r,i,n]),e.jsx(w,{fields:u})},pe=t=>[{title:e.jsxs(e.Fragment,{children:["Cycle at start",e.jsx("br",{})," of Sweet Scent"]}),key:"Cycle at start",dataIndex:"pre_sweet_scent_cycle_ranges",render:s=>s.length===0?"Less than 0":s.map(r=>`${r.start} - ${r.start+r.len-1}`).map(r=>e.jsx("div",{children:r},r))},{title:"Likelihood",dataIndex:"method_probability",render:s=>J(s)},{title:"Method",dataIndex:"method"},{title:"Species",dataIndex:"species"},{title:"PID",dataIndex:"pid",monospace:!0,render:s=>s.toString(16).padStart(8,"0").toUpperCase()},{title:"Shiny",dataIndex:"shiny",render:s=>s?"Yes":"No"},...K],_e=async(t,a,s)=>U(t).with("Fastest",()=>18).with("Slowest",()=>900).with("Average",()=>775).with("Custom",()=>a).with("From PID",()=>T.calculate_pid_speed(s)).exhaustive();let fe=0;const be=t=>({...t.searcher_res,...t.searcher_res.ivs,method_probability:t.method_probability,pre_sweet_scent_cycle_ranges:t.pre_sweet_scent_cycle_ranges,species:t.searcher_res.species,uid:fe++}),he=t=>t.map(a=>be(a)).sort((a,s)=>{var r,n,d,o;const i=(((r=a.pre_sweet_scent_cycle_ranges[0])==null?void 0:r.start)??-1)-(((n=s.pre_sweet_scent_cycle_ranges[0])==null?void 0:n.start)??-1);return i!==0?i:(((d=a.pre_sweet_scent_cycle_ranges[0])==null?void 0:d.len)??0)-(((o=s.pre_sweet_scent_cycle_ranges[0])==null?void 0:o.len)??0)}),ge=({game:t})=>{const[a,s]=p.useState([]),[i,r]=p.useState([]),n=t==="emerald"?0:1440,d=p.useCallback(async l=>{const c={tid:l.tid,sid:l.sid,map_idx:0,action:l.action,methods:["Wild1","Wild2","Wild3","Wild4","Wild5"],lead:F[l.leadIdx],filter:E(G()),gen3_filter:z(ee(),null),consider_cycles:!0,consider_rng_manipulated_lead_pid:!0,generate_even_if_impossible:!0,roamer_state:l.roamerState,mass_outbreak_state:l.massOutbreakState,feebas_state:l.feebasState},u=M.maps_data.find(j=>j.map_id===l.map);if(u==null)return s([]);const{results:m,cycle_at_moments:I}=await T.generate_gen3_wild_distribution(n,l.advance,c,u,l.leadCycleSpeed),h=he(m);s(h),r(I)},[n]),o=p.useMemo(()=>me(),[]);return e.jsxs(e.Fragment,{children:[e.jsx(L,{getColumns:pe,results:a,validationSchema:ce,initialValues:o,onSubmit:d,submitTrackerId:"wild3_method_distribution",rowKey:"uid",children:e.jsx(ue,{})}),e.jsx(oe,{cycleAtMoments:i})]})};export{ge as Wild3MethodDistribution,ue as Wild3MethodDistributionFields};
