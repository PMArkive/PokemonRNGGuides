import{bw as D,C as K,j as a,S as L,F as f,p as u,R as l,v as E,r as S,q as O,b as x,t as U}from"./index-DXZ5ShUP.js";import{R as V}from"./rngToolForm-B4hBWdo1.js";import{f as $,C as z}from"./offsetSymbol-BhtzUnCn.js";import{u as J,a as A,f as b,p as Q}from"./state-CFkWkYUl.js";import{n as W,g as X}from"./pkmFilter-Dut2CP0u.js";import{c as Y}from"./useGen3Timer-D-oFIk24.js";import{G as Z}from"./gen3Timer-Ip2_9jlj.js";import{b as ee}from"./_baseUniq-XI3c6j_G.js";import"./ivs-DDKKiU8r.js";function te(e,t){return e&&e.length?ee(e,D(t)):[]}const R=Y(),ae=[{title:"Calibrate",dataIndex:"advance",render:(e,t)=>a.jsx(z,{type:"gen3",hitAdvance:t.advance,timer:R,trackerId:"calibrate_retail_emerald_held_egg"})},{title:"Offset",dataIndex:"offset",render:$},{title:"Nature",dataIndex:"nature",render:e=>e==null?"No Egg":E(e)},{title:"Match call",dataIndex:"match_call",render:e=>E(e)}],re=U(Q.alphabetical,e=>b({name:e,withoutTitle:!0})),se=[{label:"None",value:"None"},...O(re,e=>e.label)],ne=W.optional.map(e=>({label:e.value===null?"No Egg":e.label,value:e.value})),le=X.map(e=>({label:e.value===null?"No Egg":e.label,value:e.value})),y={nature:null,gender:null,pokeNavCall:"None"},ie=[{label:"PokeNav Call",input:a.jsx(x,{name:"pokeNavCall",options:se})},{label:"Hatched Nature",input:a.jsx(x,{name:"nature",options:ne})},{label:"Hatched Gender",input:a.jsx(x,{name:"gender",options:le})}],oe=({registeredTrainers:e})=>{var C,T,j,N,w;const[t]=A(),i=l.useRef(!0),[d,v]=l.useState([]),[n,m]=l.useState([]),[r,I]=l.useState(y),h=((C=t.target)==null?void 0:C.advance)??0,g=((T=t.target)==null?void 0:T.redraws)??0,p=((j=t.target)==null?void 0:j.calibration)??0;l.useEffect(()=>{(async()=>{const s=Math.max(h-100,0),P=await S.emerald_egg_held_states({...t.eggSettings,has_roamer:!1,tid:0,sid:0,delay:0,registered_trainers:e,lua_adjustment:!0,min_redraw:g,max_redraw:g,calibration:p,initial_advances:s,max_advances:200,filter_impossible_to_hit:!1,filters:{shiny:!1,nature:null,gender:null}}),B=await S.generate_no_egg_match_calls({has_roamer:!1,calibration:p,has_lightning_rod:t.eggSettings.has_lightning_rod,max_advances:200,redraws:g,registered_trainers:e,seed:t.seed,initial_advances:s}),q=[...P,...B],M=O(te(q,c=>c.advance),c=>c.advance);m(M.map(c=>({...c,offset:c.advance-h})))})()},[h,e,t.seed,t.eggSettings,g,p]);const F=l.useCallback(async o=>{const k=n.filter(s=>s.match_call===r.pokeNavCall&&s.nature==r.nature&&s.gender==r.gender);i.current||v(k.map(s=>s.offset)),I(o),i.current=!1},[r,n]),H=l.useMemo(()=>n.filter(o=>o.match_call===r.pokeNavCall&&o.nature==r.nature&&o.gender==r.gender),[n,r]),_=(N=t.target)==null?void 0:N.match_call,G=_==="None"||_==null?"No Call":`Call from ${b({name:_,withoutTitle:!0})}`;return a.jsxs(f,{vertical:!0,gap:16,width:"100%",children:[a.jsxs(f,{vertical:!0,gap:8,children:[a.jsxs(u.Title,{level:5,mv:0,children:["Target Call: ",G]}),a.jsxs(u.Title,{level:5,mv:0,children:["Target Nature: ",(w=t.target)==null?void 0:w.nature]})]}),a.jsxs(u.Text,{mv:0,children:["Previous offsets: ",d.join(", ")]}),a.jsx(V,{fields:ie,columns:ae,results:H,initialValues:y,onSubmit:F,submitTrackerId:"filter_retail_emerald_held_egg",submitButtonLabel:"Find advances matching eggs",rowKey:"advance"})]})},_e=()=>{const[e]=J(),{hydrated:t,client:i}=K(e);return t?a.jsx(oe,{registeredTrainers:i.registeredTrainers}):a.jsx(L,{})},xe=()=>{var n,m,r;const[e]=A(),t=((n=e.target)==null?void 0:n.advance)??0,i=((m=e.target)==null?void 0:m.redraws)??0,d=(r=e.target)==null?void 0:r.match_call,v=d==="None"||d==null?"no one":b({name:d,withoutTitle:!0});return a.jsxs(f,{vertical:!0,gap:16,width:"100%",children:[a.jsxs(f,{vertical:!0,gap:8,children:[a.jsxs(u.Title,{level:5,mv:0,children:["Open the PokeDex ",i," times"]}),a.jsxs(u.Title,{level:5,mv:0,children:["Expect a call from ",v]})]}),a.jsx(Z,{trackerId:"retail_emerald_held_egg",targetAdvance:t,timer:R})]})};export{_e as CalibrateHeldEgg,xe as CalibrateHeldEggTimer};
